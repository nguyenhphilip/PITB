<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.542">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-06-21">

<title>Phil in the Blank - On psychedelics and change</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../photos/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Phil in the Blank - On psychedelics and change">
<meta name="twitter:description" content="Some words for a friend">
<meta name="twitter:creator" content="@NguyenHPhil">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">On psychedelics and change</h1>
<p class="subtitle lead">Some words for a friend</p>
  <div class="quarto-categories">
    <div class="quarto-category">psychedelics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb3fa0c7b-896c-43b4-bdbb-581f4eb9231a_3024x4032.jpeg" class="img-fluid figure-img"></p>
<figcaption>ðŸ“·: Lionâ€™s mane jellyfish I saw at the New England Aquarium!</figcaption>
</figure>
</div>
<p>Hi friends!</p>
<p>A friend recently asked me how my experience on psychedelics have changed me, relative to other major events in my life. This is a hard question to answer, partly because it feels like comparing apples to the Andromeda galaxy. There are way too many variables that would confound a meaningful comparison (apples man!), especially when it comes to a psychedelic trip and, say, my <a href="https://philintheblank.me/posts#category=Camino">journey</a> across the Camino de Santiago. Iâ€™ve also only taken them twice, each time with a moderate to high dose for the purpose of personal insight, which is to say I am no veteran of the psychonautic landscape. But Iâ€™ll try to provide a tentative answer to what I think is at the heart of the question: how have psychedelics affected my life?</p>
<p>(All the usual caveats regarding psychedelic use stand here. I ainâ€™t a doc and you should not read my words in a prescriptive fashion.)</p>
<hr>
<p>Itâ€™s worth saying at the outset that psychedelics will not solve all of your problems. If youâ€™re facing a difficult decision and/or are seeking to change your life in some significant way, Iâ€™d urge you to try addressing these things head-on, first. Travel, read books, talk to people, <strong>do</strong> things differently, patiently experiment, seek your own answers to the <a href="https://philintheblank.substack.com/p/live-the-questions">questions</a> tugging at your soulstrings. Find out whatâ€™s behind your desire to use psychedelics and see if you might be able to satisfy it without their use. Committing to this ongoing project will change you! At the very least you will become more intentional about using them, all the while cultivating your sense of personal agency.</p>
<p>Maybe Iâ€™m old school (PSA: apparently 29 is the new 30, ha..!), but I mention this because people tend to avoid the work and devotion that meaningful change requires, even when theyâ€™re aware of what they need to do. Itâ€™s a long and difficult road, so we sometimes distract ourselves with social media, mindless hook-ups, disembodied philosophies, and grandiose spirituality quests. (Yes God can be a distraction.) This is fine at times. You do not need to constantly Work On Yourself. But know that psychedelics can be a distraction too, one that can make you drastically worse off, especially at the dosages that mediate lasting change. Under their power, you may feel ready to leap into the void, only to later realize that you left your parachute behind because it was ruining the vibe.</p>
<p>Iâ€™ve used psychedelics before to help me decide whether or not to continue a relationship I was struggling with. On the surface everything seemed fine: I was creatively engaged; I was in good health; I was doing proper grad school things; I was supported in my relationship. But I was also so, so lonely. I felt directionless, incompetent, disconnected from my peers and my work, unsure of myself and what I wanted. I knew I had to change something about how I was living, but it felt like the foundation of my life would crumble if I did.</p>
<p>And it did, not long after the trip. My intention was to understand why I felt so much pain and disconnection when we were together, and to discover a way forward. What came up instead was an indecipherable hurricane of emotions. There was anger, frustration, guilt, shame, resentment, a lack of acceptance, and self-flagellation. There was also warmth, love, affection, and gratitude, too. At some point I tried to play a song on my guitar, only to find that the entirety of my conscious being was content on riding the ethereal reverberations of a single C-shaped D Major chord. This was not part of the Plan.</p>
<p>Later I went down to the lake to process the experience. It didnâ€™t reveal anything about what I should do, not really anyways. All I knew was that there was a deep conflicting pain inside of me that arose within the context of our relationship. Parts of me wanted to continue, while others wanted to leave.</p>
<p>We broke up a few days later. I felt okay about it as long as I was working or engaged in activity. But the grief welled up inside of me. And then it overcame me like a great, all-consuming wave, one I kept drowning under over and over again. Suddenly academic research felt meaningless. Similarly with writing, exercising, going outside, playing the guitarâ€”everything that once held my life up. A month goes by, and on the drive from my friendâ€™s weddingâ€“which I officiatedâ€“I realized that I needed help as I imagined, through merciless tears, what itâ€™d be like if I suddenly drove off the edge of the 89.</p>
<p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F068ebe88-93dc-4c5d-aeb7-94716e88444d_4032x3024.jpeg" class="img-fluid"></p>
<p>After the wedding, I took a few weeks off from working on my PhD and stayed with my parents in California. Being away from Vermont made me realize how misplaced I felt in academia. It was the available and appealing path, one encouraged by my wonderful lab members, but I did not want to <a href="https://philintheblank.substack.com/p/i-left-my-phd">walk</a> it. A close friend I trusted gave me heartfelt advice and difficult feedback around the same time. It came from a place of genuine concern and compassion, but I was not ready to hear it yet. Any idle moment I had was immediately filled with heaviness and despair, leaving me feeling helpless and trapped. I felt unhinged and alone and afraid that things would never improve.</p>
<p>Some of my friendâ€™s wisdom must have seeded itself in me though. This, alongside the small but ongoing support of friends and parents, gave me enough inertia to begin helping myself. And then, eventually, I got lucky. I landed a job that allowed me to leave my PhD. I made more proximate friends and widened my circle of social engagement. I reconnected with my ex. (Things ended again later, but on a better note.) I rekindled my creative spirit. (Thank you <a href="https://notes.ellenrhymes.com/RRR">RRR</a>, Dialogic Circle, and others!) I sought more help. I started recognizing what was important to me and acted on it. And I got better, bit by bit.</p>
<hr>
<p>The brain seems to become more malleable after psychedelic use, meaning itâ€™s easier for new patterns of thought and behavior to form and settle. This is usually framed in a positive light, but itâ€™s possible that the changes run the other way too. In my case, the post-trip/post-breakup pit I found myself in was potentially deepened by the intensity of my grief and depression. If true, it suggests that extreme care should be taken when considering psychedelically-mediated life changes. It could have gone much worse than it did, and I recommend against making such big changes all at once, at least not without support, nor without having exhausted other options.</p>
<p>Truthfully, what I needed was a robust structure in place to help me transition through the major life decisions I was contemplating. I needed a close friend or two who was consistent and physically there for me; a good therapist, perhaps; work and activity that felt meaningful; a large dose of courage, and the momentum of baby steps.</p>
<p>In a sense then, psychedelics kind of ruined my life. They enabled me to make a decision about the relationship and later my PhD, but I was unprepared for the immensity of the losses and everything else that quickly followed. In another sense, they saved me. They made me more sensitive and receptive to the signals radiating from my body. They wiped off the smudge marks from my inner compass and revealed the urgency of the work ahead. Itâ€™s true that, sometimes, one has to <a href="https://sashachapin.substack.com/p/in-praise-of-blowing-up-your-life">completely uproot</a> their lives and go through hell in order to build a better one, for every person involved.</p>
<p>When I decided to walk the Camino, it was not an answer to a call for adventure exactly, but rather a lack of options and the necessity of the moment. I had read about it in a <a href="https://www.perseusbooks.com/titles/kamal-ravikant/rebirth/9780316312257/">story</a> and told myself I would walk it one day in the far future. Well, that day came much sooner than I expected. I was working at a summer camp in Maine and had just been denied a job I wanted for when camp ended. Days later, feeling liminal while drifting alone in the middle of a lake on a paddle board, the idea to trek across Spain came to me. It was more a suggestion than a compelling vision, one that was incredibly far-fetched and impractical, but I knew it was what I had to do. I didnâ€™t know how I was going to do it, but I paddled back to shore and immediately booked a one-way ticket to Europe.</p>
<p>There I met some very wonderful people. I stuffed my face with Spanish Tortillas. I deepened my felt understanding of love and joy. I began to write more seriously. I fell in love with my <a href="https://philintheblank.me/posts/14c-letters-soulmate/">Camino soulmate</a>. I ran out of money. But there were still parts of me that felt just as lost as I did prior to the journey when I came back home. I still had to figure out where I wanted to live, how to earn an income, and so on, all of which was constrained by a budding sense of urgency (and a negative bank account). Iâ€™d been thinking about pursuing a PhD in clinical psychology even before Spain, and this was what I thought I still wanted to do, which led me to Vermont, my home for the past five years. Now I have a masters degree in complex systems and data science, lol.</p>
<p>So, Spain changed me I think, but I canâ€™t really tell you how. In many ways I feel like Iâ€™m the same person as I was prior to the walk. Thatâ€™s how I kind of feel now regarding my experience with psychedelics. Perhaps these experiences have allowed me to become more me, which is sadly not always an easy feat. All I feel certain about is that change is hard. And itâ€™s hard not because we resist change itself, but <a href="https://haleynahman.substack.com/p/voice-note-changing-your-life-without#details">something else</a> beneath the surface.</p>
<p>Psychedelics can help you dig beneath the surface and untangle the emotional roadblocks that are preventing you from improving your life. They can tease out old patterns of thought and behavior, and make them more amenable to revision and replacement. This is often the work itself and why people turn to psychedelics. But without the proper scaffolding in place, itâ€™s not improbable that you may fall back into the old patterns you were hoping to change. God may show himself to you, but what will you do about it if he tells you to go home? If he wants to know how you will change your life?</p>
<p>In addition to the possibility of revision, we need our earthly visions too, a re-visioning of sorts on a personal and collective level, a concrete sense of where we want to go and who we want to be, if change is to last. Psychedelics can show you what itâ€™s like to feel more connected to yourself, others, and the world, what might be worth aspiring towards. They can open up the door to meaningful change and ease the first steps of a lifelong endeavor. But you will still need to do the work that the universe requires of you when you come back down to Earth. And maybe that work is a stroll across Spain.</p>
<p><em>Thanks Aly &amp; Shirley for the feedback on this essay.</em></p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>